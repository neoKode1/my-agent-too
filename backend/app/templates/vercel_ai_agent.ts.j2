/**
 * {{ project_name }} â€” {{ template_name }}
 *
 * {{ template_description }}
 *
 * Generated by +12 Monkeys â€¢ Framework: Vercel AI SDK
 */

import { generateText, streamText } from "ai";
import { anthropic } from "@ai-sdk/anthropic";
import { z } from "zod";
import "dotenv/config";

// ---------------------------------------------------------------------------
// Model Configuration
// ---------------------------------------------------------------------------
const model = anthropic(process.env.LLM_MODEL ?? "claude-sonnet-4-20250514");

// ---------------------------------------------------------------------------
// Agent Definitions
// ---------------------------------------------------------------------------
{% for agent in agents %}
/**
 * {{ agent.role }} â€” {{ agent.goal }}
 */
async function {{ agent.role }}Agent(input: string{% if not loop.first %}, context: string{% endif %}): Promise<string> {
  const { text } = await generateText({
    model,
    system: `You are the {{ agent.role }} agent. Your goal: {{ agent.goal }}`,
    prompt: [
      `Input: ${input}`,
      {% if not loop.first %}
      `Previous step context: ${context}`,
      {% endif %}
      "Provide your output:",
    ].join("\n"),
    maxTokens: 4096,
  });
  return text;
}

{% endfor %}

// ---------------------------------------------------------------------------
// Pipeline
// ---------------------------------------------------------------------------
async function runPipeline(userInput: string): Promise<string> {
  console.log(`\nðŸš€ Starting {{ project_name }} pipeline...\n`);

  let currentOutput = userInput;
  {% for agent in agents %}

  // Step {{ loop.index }}: {{ agent.role }}
  console.log("  â³ Running {{ agent.role }}...");
  currentOutput = await {{ agent.role }}Agent(userInput{% if not loop.first %}, currentOutput{% endif %});
  console.log("  âœ… {{ agent.role }} complete");
  {% endfor %}

  return currentOutput;
}

// ---------------------------------------------------------------------------
// Entry Point
// ---------------------------------------------------------------------------
const userInput = process.argv.slice(2).join(" ") || "Hello, I need help.";
runPipeline(userInput).then((result) => {
  console.log(`\nâœ… Result:\n${result}`);
});

