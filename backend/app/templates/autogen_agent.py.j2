"""{{ project_name }} â€” {{ template_name }}

{{ template_description }}

Generated by +12 Monkeys â€¢ Framework: AutoGen
"""

import os
from dotenv import load_dotenv
from autogen import AssistantAgent, UserProxyAgent, GroupChat, GroupChatManager

load_dotenv()

# ---------------------------------------------------------------------------
# LLM Configuration
# ---------------------------------------------------------------------------
llm_config = {
    "model": os.getenv("LLM_MODEL", "claude-sonnet-4-20250514"),
    "api_key": os.getenv("ANTHROPIC_API_KEY"),
    "api_type": "anthropic",
}

# ---------------------------------------------------------------------------
# Agent Definitions
# ---------------------------------------------------------------------------
{% for agent in agents %}
{{ agent.role }}_agent = AssistantAgent(
    name="{{ agent.role }}",
    system_message=(
        "You are the {{ agent.role }} agent. "
        "Your goal: {{ agent.goal }}"
    ),
    llm_config=llm_config,
)

{% endfor %}

# Human proxy for initiating tasks
user_proxy = UserProxyAgent(
    name="user_proxy",
    human_input_mode="NEVER",
    max_consecutive_auto_reply={{ config.get('max_rounds', 10) }},
    code_execution_config=False,
)

# ---------------------------------------------------------------------------
# Group Chat
# ---------------------------------------------------------------------------
group_chat = GroupChat(
    agents=[
        user_proxy,
        {% for agent in agents %}
        {{ agent.role }}_agent,
        {% endfor %}
    ],
    messages=[],
    max_round={{ config.get('max_rounds', 10) }},
)

manager = GroupChatManager(groupchat=group_chat, llm_config=llm_config)


# ---------------------------------------------------------------------------
# Entry Point
# ---------------------------------------------------------------------------
def main():
    import sys
    user_input = " ".join(sys.argv[1:]) if len(sys.argv) > 1 else "Hello, I need help."
    print(f"\nðŸš€ Starting {{ project_name }} group chat...\n")
    user_proxy.initiate_chat(manager, message=user_input)
    print("\nâœ… Group chat complete.")


if __name__ == "__main__":
    main()

